(()=>{"use strict";function e(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}var t,n,o,r,c,i,a,l,u,s,d,h,m,f,g=function(t,n,o,r,c,i){var a,l=t.createLinearGradient(n,o,r,c),u=function(t,n){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=function(t,n){if(t){if("string"==typeof t)return e(t,n);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?e(t,n):void 0}}(t))||n&&t&&"number"==typeof t.length){o&&(t=o);var r=0,c=function(){};return{s:c,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(e){throw e},f:c}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,l=!1;return{s:function(){o=o.call(t)},n:function(){var e=o.next();return a=e.done,e},e:function(e){l=!0,i=e},f:function(){try{a||null==o.return||o.return()}finally{if(l)throw i}}}}(i);try{for(u.s();!(a=u.n()).done;){var s=a.value;l.addColorStop(s.percent,s.color)}}catch(e){u.e(e)}finally{u.f()}return l},y=Object.freeze({gain:.5,numSamples:256});function b(e){n.src=e}function p(e){e?(i.frequency.setValueAtTime(1e3,t.currentTime),i.gain.setValueAtTime(35,t.currentTime)):i.gain.setValueAtTime(0,t.currentTime)}function v(e){e?(a.frequency.setValueAtTime(1e3,t.currentTime),a.gain.setValueAtTime(15,t.currentTime)):a.gain.setValueAtTime(0,t.currentTime)}function S(e,t){e?(l.curve=null,l.curve=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20,t=new Float32Array(256),n=0;n<256;++n){var o=2*n/256-1;t[n]=(Math.PI+e)*o/(Math.PI+e*Math.abs(o))}return t}(t)):l.curve=null}function w(e){return w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},w(e)}function q(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,k(o.key),o)}}function k(e){var t=function(e,t){if("object"!==w(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,"string");if("object"!==w(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===w(t)?t:String(t)}new Uint8Array(y.numSamples/2);var x,I,T=function(){function e(t,n,o,r,c){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.x=t,this.y=n,this.img=new Image,this.scale=1,this.width=o,this.height=r,this.xDirection=1,this.yDirection=1.2,this.filename=c,this.preloadImage()}var t,n;return t=e,n=[{key:"update",value:function(){this.x+=this.xDirection,this.y+=this.yDirection,(this.x>=800-this.width||this.x<=0)&&(this.xDirection=-this.xDirection),(this.y>=400-this.height||this.y<=0)&&(this.yDirection=-this.yDirection)}},{key:"draw",value:function(e){e.save(),e.translate(this.x,this.y),e.scale(this.scale,this.scale),e.drawImage(this.img,0-this.width/2,0-this.height/2),e.restore()}},{key:"changeScale",value:function(e){this.scale=e,this.scale<=.3&&(this.scale=.3)}},{key:"preloadImage",value:function(){console.log("Hi"),this.img.src="./media/images/".concat(this.filename,".png"),this.img.crossOrigin="Anonymous"}},{key:"changeImage",value:function(e){0!=e&&1!=e||(this.img.src="./media/images/kh.png"),2!=e&&3!=e||(this.img.src="./media/images/sonic.png"),4!=e&&5!=e||(this.img.src="./media/images/smt.png")}}],n&&q(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();x=T,(I=k(I="type"))in x?Object.defineProperty(x,I,{value:"arc",enumerable:!0,configurable:!0,writable:!0}):x[I]="arc";var M,A,F=new T(400,200,500,500,"kh"),N=new T(200,200,100,40,"dvd"),C="black",P="white",j=function(e){M=e},H={showGradient:document.querySelector("#cb-gradient").checked,showBars:document.querySelector("#cb-bars").checked,showCircles:document.querySelector("#cb-circles").checked,showNoise:document.querySelector("#cb-noise").checked,showInvert:document.querySelector("#cb-invert").checked,showEmboss:document.querySelector("#cb-emboss").checked,showImage:document.querySelector("#cb-image").checked,showBounce:document.querySelector("#cb-bounce").checked,imageNumber:document.querySelector("#trackSelect").options[document.querySelector("#trackSelect").selectedIndex].index,showFrequency:document.querySelector("#cb-frequency").checked},L=!1,D=!1,E=!1,R=20,O=[],B=[],z=[],G=[],V=[],U=Object.freeze({sound1:"media/audio/Lord of the Castle.mp3"}),W=function(){var e,p,v;$(),e=U.sound1,p=window.AudioContext||window.webkitAudioContext,t=new p,n=new Audio,b(e),o=t.createMediaElementSource(n),(i=t.createBiquadFilter()).type="highshelf",(a=t.createBiquadFilter()).type="lowshelf",(l=t.createWaveShaper()).type="distortion",(r=t.createAnalyser()).fftSize=y.numSamples,(c=t.createGain()).gain.value=y.gain,o.connect(i),i.connect(a),a.connect(l),l.connect(r),r.connect(c),c.connect(t.destination),console.log("init called"),console.log("Testing utils.getRandomColor() import: ".concat("rgba(".concat((v=function(){return 185*Math.random()+35})(),",").concat(v(),",").concat(v(),",1)")));var S=document.querySelector("canvas");J(S),function(e,t){u=e.getContext("2d"),s=e.width,d=e.height,h=g(u,0,0,0,d,[{percent:0,color:C},{percent:.25,color:P},{percent:.5,color:C},{percent:.75,color:P},{percent:1,color:C}]),m=t,f=new Uint8Array(m.fftSize/2)}(S,r),X()},J=function(e){document.querySelector("#btn-fs").onclick=function(t){var n;console.log("init called"),(n=e).requestFullscreen?n.requestFullscreen():n.mozRequestFullscreen?n.mozRequestFullscreen():n.mozRequestFullScreen?n.mozRequestFullScreen():n.webkitRequestFullscreen&&n.webkitRequestFullscreen()};var o=document.querySelector("#btn-play");o.onclick=function(e){console.log("audioCtx.state before = ".concat(t.state)),"suspended"==t.state&&t.resume(),console.log("audioCtx.state after = ".concat(t.state)),"no"==e.target.dataset.playing?(n.play(),e.target.dataset.playing="yes"):(n.pause(),e.target.dataset.playing="no"),document.querySelector("#cb-gradient").onclick=function(e){H.showGradient=e.target.checked},document.querySelector("#cb-bars").onclick=function(e){H.showBars=e.target.checked},document.querySelector("#cb-circles").onclick=function(e){H.showCircles=e.target.checked},document.querySelector("#cb-noise").onclick=function(e){H.showNoise=e.target.checked},document.querySelector("#cb-invert").onclick=function(e){H.showInvert=e.target.checked},document.querySelector("#cb-emboss").onclick=function(e){H.showEmboss=e.target.checked},document.querySelector("#cb-image").onclick=function(e){H.showImage=e.target.checked},document.querySelector("#cb-bounce").onclick=function(e){H.showBounce=e.target.checked},document.querySelector("#cb-frequency").onclick=function(e){H.showFrequency=e.target.checked}};var r=document.querySelector("#slider-volume"),i=document.querySelector("#volumeLabel");r.oninput=function(e){!function(e){e=Number(e),c.gain.value=e}(e.target.value),i.innerHTML=Math.round(e.target.value/2*100)},r.dispatchEvent(new Event("input"));var a=document.querySelector("#trackSelect");a.onchange=function(e){b(e.target.value),"yes"==o.dataset.playing&&o.dispatchEvent(new MouseEvent("click")),console.log(a.options[a.selectedIndex].index),document.querySelector("#lb-name").innerHTML=O[a.options[a.selectedIndex].index],document.querySelector("#lb-game").innerHTML=z[a.options[a.selectedIndex].index],document.querySelector("#lb-composer").innerHTML=G[a.options[a.selectedIndex].index],document.querySelector("#lb-context").innerHTML=V[a.options[a.selectedIndex].index],document.querySelector("#the_image").src="./media/images/".concat(a.options[a.selectedIndex].index,".jpg"),H.imageNumber=a.options[a.selectedIndex].index,function(e){0==e&&(C="black",P="white"),1==e&&(C="blue",P="white"),2==e&&(C="pink",P="purple"),3==e&&(C="red",P="blue"),4==e&&(C="yellow",P="black"),5==e&&(C="white",P="blue"),h=g(u,0,0,0,d,[{percent:0,color:C},{percent:.25,color:P},{percent:.5,color:C},{percent:.75,color:P},{percent:1,color:C}])}(a.options[a.selectedIndex].index)},document.querySelector("#cb-highshelf").checked=L,document.querySelector("#cb-highshelf").onchange=function(e){p(L=e.target.checked)},p(L),document.querySelector("#cb-lowshelf").checked=D,document.querySelector("#cb-lowshelf").onchange=function(e){v(D=e.target.checked)},v(D),document.querySelector("#cb-distortion").checked=E,document.querySelector("#cb-distortion").onchange=function(e){S(E=e.target.checked,R)},document.querySelector("#slider-distortion").value=R,document.querySelector("#slider-distortion").onchange=function(e){R=Number(e.target.value),S(E,R),console.log(R)},document.querySelector("#slider-barNumber").value=A,document.querySelector("#slider-barNumber").onchange=function(e){A=Number(e.target.value),j(A),console.log(A)}},X=function e(){setTimeout(e,1e3/60),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(e.showFrequency&&m.getByteFrequencyData(f),0==e.showFrequency&&m.getByteTimeDomainData(f),u.save(),u.fillStyle="black",u.globalAlpha=.1,u.fillRect(0,0,s,d),u.restore(),e.showGradient&&(u.save(),u.fillStyle=h,u.globalAlpha=.3,u.fillRect(0,0,s,d),u.restore()),e.showBars)for(var t=0,n=Math.PI/2,o=2*Math.PI/M,r=0,c=(130-M)/5,i=0;i<M;i++){u.save(),u.fillStyle="white";var a=(f[i]+20)/2,l=t,g=d/3;u.fillStyle="rgba(".concat(r,",").concat(r,",").concat(r,",0.50)"),u.strokeStyle="white";var y=g*Math.cos(l)+400,b=g*Math.sin(l)+200;u.translate(y,b),u.rotate(n),u.fillRect(0-c/2,0,c,-a),u.strokeRect(0-c/2,0,c,-a),t+=2*Math.PI/M,n+=o,u.restore(),r+=2}if(e.showCircles){var p=d/3;u.save(),u.globalAlpha=.5;for(var v=0;v<f.length;v++)u.beginPath(),u.fillStyle="white",u.strokeStyle="black",u.lineWidth=3,u.arc(s/2,d/2,p,0,2*Math.PI,!1),u.fill(),u.stroke(),u.closePath();u.restore()}if(e.showImage){F.changeImage(e.imageNumber);for(var S=0;S<f.length;S++){var w=f[5]/512;F.changeScale(w)}F.draw(u)}e.showBounce&&(N.update(),N.draw(u));for(var q=u.getImageData(0,0,s,d),k=q.data,x=k.length,I=q.width,T=0;T<x;T++)if(e.showNoise&&Math.random()<.05&&(k[T]=k[T+1]=k[T+2]=0,k[T]=255),e.showInvert){var A=k[T],C=k[T+1],P=k[T+2];k[T]=255-A,k[T+1]=255-C,k[T+2]=255-P}if(e.showEmboss)for(var j=0;j<x;j++)j%4!=3&&(k[j]=127+2*k[j]-k[j+4]-k[j+4*I]);u.putImageData(q,0,0)}(H)},$=function(){var e=new XMLHttpRequest;e.onload=function(e){console.log("In onload - HTTP Status Code = ".concat(e.target.status));var t=JSON.parse(e.target.responseText),n=Object.keys(t),o=t[n[0]];document.querySelector("#title").innerHTML=o;for(var r=t[n[1]],c=0,i=Object.keys(r);c<i.length;c++){var a=i[c];console.log(a),O.push(r[a].songName),B.push(r[a].fileName),z.push(r[a].gameName),G.push(r[a].composerName),V.push(r[a].context)}for(var l=0;l<O.length;l++)console.log(B[l]);document.querySelector("#lb-name").innerHTML=O[0],document.querySelector("#lb-game").innerHTML=z[0],document.querySelector("#lb-composer").innerHTML=G[0],document.querySelector("#lb-context").innerHTML=V[0],A=t[n[2]],j(A),console.log(A)},e.onerror=function(e){return console.log("In onerror - HTTP Status Code = ".concat(e.target.status))},e.open("GET","data/av-data.json"),e.send()};window.onload=function(){console.log("window.onload called"),W()}})();